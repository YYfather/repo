<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‹±è¯­é€‰è¯å¡«ç©ºåˆ·é¢˜ç»ƒä¹  Pro</title>
    <style>
        :root {
            --primary-color: #2563eb;
            --primary-hover: #1d4ed8;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-color: #f3f4f6;
            --card-bg: #ffffff;
            --text-main: #1f2937;
            --text-secondary: #6b7280;
            --border-color: #e5e7eb;
            --option-hover: #f0f9ff;
        }

        /* å¤œé—´æ¨¡å¼å˜é‡ */
        [data-theme="dark"] {
            --primary-color: #3b82f6;
            --primary-hover: #60a5fa;
            --success-color: #34d399;
            --error-color: #f87171;
            --warning-color: #fbbf24;
            --bg-color: #111827;
            --card-bg: #1f2937;
            --text-main: #f3f4f6;
            --text-secondary: #9ca3af;
            --border-color: #374151;
            --option-hover: #374151;
        }

        * { box-sizing: border-box; transition: background-color 0.3s, color 0.3s, border-color 0.3s; }
        
        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            background-color: var(--bg-color);
            color: var(--text-main);
            min-height: 100vh;
        }

        /* --- è¿˜åŸåŸå§‹ä½œè€…ä¸æ°´å°æ ·å¼ (å«å¤œé—´æ¨¡å¼é€‚é…) --- */
        .original-watermark {
            text-align: center;
            background-color: #e0f7fa;
            padding: 10px;
            border-radius: 6px;
            margin-bottom: 10px;
            border: 2px solid #00bcd4;
            font-weight: bold;
            color: #00796b;
            font-size: 16px;
        }
        .original-author {
            text-align: center;
            background-color: #fff3e0;
            padding: 8px;
            border-radius: 4px;
            margin-bottom: 15px;
            border: 1px solid #ff9800;
            font-weight: bold;
            color: #e65100;
            font-size: 15px;
        }

        /* æ°´å°éƒ¨åˆ†çš„å¤œé—´æ¨¡å¼é€‚é… */
        [data-theme="dark"] .original-watermark {
            background-color: #064e3b; /* æ·±é’è‰²èƒŒæ™¯ */
            color: #6ee7b7;            /* æµ…é’è‰²æ–‡å­— */
            border-color: #059669;
        }
        [data-theme="dark"] .original-author {
            background-color: #7c2d12; /* æ·±æ©™è‰²èƒŒæ™¯ */
            color: #fdba74;            /* æµ…æ©™è‰²æ–‡å­— */
            border-color: #ea580c;
        }

        /* é¡¶éƒ¨å·¥å…·æ  */
        .header-tools {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .theme-toggle, .settings-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 24px;
            color: var(--text-secondary);
            padding: 5px;
            border-radius: 50%;
        }
        .theme-toggle:hover { background-color: var(--border-color); }

        h1 { text-align: center; color: var(--primary-color); margin: 10px 0 20px; font-size: 2rem; }

        .container {
            background-color: var(--card-bg);
            padding: 30px;
            border-radius: 16px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            position: relative;
            overflow: hidden;
            min-height: 400px;
        }

        /* æŒ‰é’®æ ·å¼ */
        .btn-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 25px;
        }

        .btn {
            padding: 10px 24px;
            font-size: 15px;
            font-weight: 600;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transform: translateY(0);
            transition: all 0.2s;
        }

        .btn:active { transform: translateY(1px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }

        .btn-primary { background-color: var(--primary-color); }
        .btn-primary:hover { background-color: var(--primary-hover); }

        .btn-secondary { background-color: var(--text-secondary); }
        .btn-secondary:hover { background-color: #4b5563; }

        .btn-danger { background-color: var(--error-color); }
        .btn-danger:hover { background-color: #dc2626; }

        .btn-warning { background-color: var(--warning-color); color: #fff; }
        .btn-warning:hover { background-color: #d97706; }

        /* ç»Ÿè®¡çœ‹æ¿ */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background-color: var(--bg-color);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-value { font-size: 24px; font-weight: bold; color: var(--primary-color); }
        .stat-label { font-size: 13px; color: var(--text-secondary); margin-top: 5px; }

        /* é¢˜ç›®åŒºåŸŸ */
        .question-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            color: var(--text-secondary);
            font-size: 14px;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .mode-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 12px;
            margin-right: 5px;
        }

        /* è‡ªåŠ¨åˆ‡é¢˜å¼€å…³æ ·å¼ */
        .auto-advance-wrapper {
            display: flex;
            align-items: center;
            font-size: 13px;
            cursor: pointer;
            user-select: none;
        }
        .auto-advance-wrapper input {
            margin-right: 6px;
            cursor: pointer;
            width: 16px;
            height: 16px;
        }

        .question-text {
            font-size: 1.25rem;
            line-height: 1.6;
            margin-bottom: 25px;
            font-weight: 500;
        }

        .highlight-blank {
            display: inline-block;
            min-width: 60px;
            border-bottom: 2px solid var(--primary-color);
            text-align: center;
            color: var(--primary-color);
            font-weight: bold;
            padding: 0 5px;
        }

        .options-grid {
            display: grid;
            gap: 12px;
        }

        .option-card {
            display: flex;
            align-items: center;
            padding: 15px;
            background-color: var(--bg-color);
            border: 2px solid transparent;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .option-card:hover {
            background-color: var(--option-hover);
            border-color: var(--primary-color);
        }

        .option-key {
            width: 30px;
            height: 30px;
            background-color: var(--border-color);
            color: var(--text-secondary);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 15px;
            font-weight: bold;
            font-size: 14px;
        }

        /* çŠ¶æ€æ ·å¼ */
        .option-card.correct {
            background-color: rgba(16, 185, 129, 0.1);
            border-color: var(--success-color);
            color: var(--success-color);
        }
        .option-card.correct .option-key { background-color: var(--success-color); color: white; }

        .option-card.incorrect {
            background-color: rgba(239, 68, 68, 0.1);
            border-color: var(--error-color);
            color: var(--error-color);
        }
        .option-card.incorrect .option-key { background-color: var(--error-color); color: white; }

        /* è§£æåŒºåŸŸ */
        .analysis-box {
            margin-top: 25px;
            padding: 20px;
            background-color: var(--bg-color);
            border-radius: 10px;
            border-left: 5px solid var(--primary-color);
            display: none;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .analysis-box h4 { margin: 0 0 10px; color: var(--text-main); }
        .translation { color: var(--text-secondary); font-style: italic; }

        /* è¿›åº¦æ¡ */
        .progress-wrapper {
            margin-top: 30px;
            background-color: var(--border-color);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            background-color: var(--success-color);
            transition: width 0.4s ease;
        }

        /* å¿«æ·é”®æç¤º */
        .keyboard-hint {
            text-align: center;
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 20px;
            opacity: 0.7;
        }
        .key-badge {
            background: var(--border-color);
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 2px;
            font-family: monospace;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }
        .modal-content {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .modal textarea {
            width: 100%;
            height: 150px;
            margin: 10px 0;
            padding: 10px;
            background: var(--bg-color);
            border: 1px solid var(--border-color);
            color: var(--text-main);
            border-radius: 6px;
        }

        @media (max-width: 600px) {
            .btn { width: 100%; margin-bottom: 5px; }
            .question-text { font-size: 1.1rem; }
            .keyboard-hint { display: none; }
            .header-tools { margin-bottom: 10px; }
        }
    </style>
</head>
<body>
    <div class="original-watermark">è¯¥ç½‘é¡µä»…ä¾›äº¤æµï¼Œéç›ˆåˆ©ï¼Œè‹¥ä½ ä»˜è´¹è·å–ï¼Œè¯·è”ç³»QQï¼š1490473838</div>
    <div class="original-author">ä½œè€…ï¼šéœ¡éœ‚</div>

    <div class="header-tools">
        <div></div> <div>
            <button class="theme-toggle" onclick="toggleTheme()" title="åˆ‡æ¢å¤œé—´æ¨¡å¼">ğŸŒ“</button>
            <button class="settings-btn" onclick="openDataModal()" title="æ•°æ®ç®¡ç†">ğŸ’¾</button>
        </div>
    </div>

    <h1>è‹±è¯­é€‰è¯å¡«ç©ºåˆ·é¢˜è½¯ä»¶ Pro</h1>

    <div class="container">
        <div id="stats-view">
            <div class="btn-group">
                <button class="btn btn-primary" onclick="startPractice('random')">ğŸ² éšæœºåˆ·é¢˜</button>
                <button class="btn btn-secondary" onclick="startPractice('sequential')">ğŸ“ é¡ºåºåˆ·é¢˜</button>
                <button class="btn btn-danger" onclick="startPractice('review')" id="btn-review-mistakes">ğŸ’Š é”™é¢˜é‡ç»ƒ</button>
            </div>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-total">0</div>
                    <div class="stat-label">æ€»é¢˜åº“</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-done">0</div>
                    <div class="stat-label">å·²åˆ·é¢˜æ•°</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-accuracy" style="color: var(--success-color)">0%</div>
                    <div class="stat-label">æ­£ç¡®ç‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-wrong" style="color: var(--error-color)">0</div>
                    <div class="stat-label">é”™é¢˜æœ¬</div>
                </div>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <button class="btn btn-warning" onclick="resetAllProgress()" style="font-size: 14px; padding: 5px 15px;">ğŸ—‘ï¸ é‡ç½®æ‰€æœ‰è¿›åº¦</button>
            </div>
        </div>

        <div id="quiz-view" style="display: none;">
            <div class="question-meta">
                <span>
                    <span id="mode-badge" class="mode-badge">éšæœºæ¨¡å¼</span>
                    ç¬¬ <span id="current-index-display">1</span> é¢˜
                </span>
                
                <label class="auto-advance-wrapper" title="ç­”å¯¹åè‡ªåŠ¨è¿›å…¥ä¸‹ä¸€é¢˜">
                    <input type="checkbox" id="auto-advance-toggle" onchange="toggleAutoAdvance()">
                    <span>âš¡ è‡ªåŠ¨åˆ‡é¢˜</span>
                </label>

                <span>å‰©ä½™: <span id="remaining-count">0</span></span>
            </div>

            <div id="question-text" class="question-text"></div>
            
            <div id="options-container" class="options-grid"></div>

            <div id="analysis-box" class="analysis-box">
                <h4 id="feedback-title">è§£æ</h4>
                <p id="translation-text" class="translation"></p>
                <div style="margin-top: 15px; text-align: right;">
                    <button class="btn btn-primary" id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ (Enter) âœ</button>
                </div>
            </div>

            <div class="progress-wrapper">
                <div id="session-progress" class="progress-bar" style="width: 0%"></div>
            </div>

            <div style="margin-top: 20px; display: flex; justify-content: space-between;">
                <button class="btn btn-secondary" onclick="exitPractice()" style="padding: 5px 15px; font-size: 12px;">âœ• ç»“æŸç»ƒä¹ </button>
                <button class="btn btn-warning" onclick="showAnswer()" id="show-answer-btn" style="padding: 5px 15px; font-size: 12px;">ğŸ‘ï¸ æŸ¥çœ‹ç­”æ¡ˆ</button>
            </div>
        </div>
    </div>

    <div class="keyboard-hint">
        å¿«æ·é”®: <span class="key-badge">1</span>-<span class="key-badge">4</span> é€‰æ‹©ç­”æ¡ˆ &nbsp;|&nbsp; <span class="key-badge">Enter</span> ä¸‹ä¸€é¢˜
    </div>

    <div id="data-modal" class="modal">
        <div class="modal-content">
            <h3>æ•°æ®å¤‡ä»½ä¸æ¢å¤</h3>
            <p style="font-size: 12px; color: var(--text-secondary);">å¤åˆ¶ä¸‹æ–¹ä»£ç ä¿å­˜å¤‡ä»½ï¼Œæˆ–ç²˜è´´ä»£ç æ¢å¤è¿›åº¦ã€‚</p>
            <textarea id="data-area"></textarea>
            <div style="text-align: right; gap: 10px; display: flex; justify-content: flex-end;">
                <button class="btn btn-secondary" onclick="closeDataModal()">å…³é—­</button>
                <button class="btn btn-primary" onclick="importData()">æ¢å¤æ•°æ®</button>
            </div>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒé¢˜åº“æ•°æ® ---
        const rawQuestionBank = [
            {"question": "In schools, teachers and pupils alike often _____ that if a concept has been easy to learn, then the lesson has been successful.", "answer": "assume", "translation": "åœ¨å­¦æ ¡é‡Œï¼Œæ•™å¸ˆå’Œå­¦ç”Ÿå¾€å¾€è®¤ä¸ºï¼Œå¦‚æœæŸä¸ªæ¦‚å¿µå®¹æ˜“æŒæ¡ï¼Œé‚£ä¹ˆè¿™èŠ‚è¯¾å°±ç®—æˆåŠŸäº†ã€‚"},
            {"question": "Lu Xun produced many long-lasting short stories, the themes of which cover an extensive _____ and reflect a multitude of aspects of social life.", "answer": "range", "translation": "é²è¿…åˆ›ä½œäº†å¤§é‡æµä¼ ä¹…è¿œçš„çŸ­ç¯‡å°è¯´ï¼Œé¢˜æå¹¿æ³›ï¼Œåæ˜ äº†ç¤¾ä¼šç”Ÿæ´»çš„æ–¹æ–¹é¢é¢ã€‚"},
            {"question": "These arguments were _____ a hundred years ago and they still hold true today.", "answer": "valid", "translation": "è¿™äº›è®ºç‚¹åœ¨ä¸€ç™¾å¹´å‰æˆç«‹ï¼Œè‡³ä»Šä¾ç„¶é€‚ç”¨ã€‚"},
            {"question": "The president said curbing the addiction of alcohol would save money and _____ lives.", "answer": "prolong", "translation": "æ€»ç»Ÿè¡¨ç¤ºï¼Œéåˆ¶é…’ç²¾æˆç˜¾å°†èŠ‚çœèµ„é‡‘å¹¶å»¶é•¿å¯¿å‘½ã€‚"},
            {"question": "The total amount raised so far is _____ $1,000.", "answer": "approaching", "translation": "åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ€»å…±ç­¹é›†çš„èµ„é‡‘å·²æ¥è¿‘ 1000 ç¾å…ƒã€‚"},
            {"question": "There is still no general _____ on whether global warming is real or not.", "answer": "consensus", "translation": "å…³äºå…¨çƒå˜æš–æ˜¯å¦çœŸå®å­˜åœ¨ï¼Œç›®å‰ä»æœªè¾¾æˆæ™®éå…±è¯†ã€‚"},
            {"question": "For decades, the U.S. led the world in the proportion of citizens with college degrees, but in recent years it has been _____ by other countries.", "answer": "surpassed", "translation": "æ•°åå¹´æ¥ï¼Œç¾å›½åœ¨å…¬æ°‘å¤§å­¦å­¦å†æ¯”ä¾‹æ–¹é¢é•¿æœŸä½å±…å…¨çƒé¦–ä½ï¼Œä½†è¿‘å¹´æ¥å·²è¢«å…¶ä»–å›½å®¶è¶…è¶Šã€‚"},
            {"question": "It is the company's _____ decision to sell part of its business to focus on its core products.", "answer": "strategic", "translation": "è¿™æ˜¯å…¬å¸çš„ä¸€é¡¹æˆ˜ç•¥å†³ç­–ï¼Œå³å‡ºå”®éƒ¨åˆ†ä¸šåŠ¡ä»¥ä¸“æ³¨äºå…¶æ ¸å¿ƒäº§å“ã€‚"},
            {"question": "Although she once _____ freedom and independence, she now gives up her career and becomes a devoted housewife.", "answer": "preached", "translation": "å¥¹è™½æ›¾é«˜å‘¼è‡ªç”±ç‹¬ç«‹ï¼Œå¦‚ä»Šå´æ”¾å¼ƒäº‹ä¸šï¼Œç”˜å½“è´¤å¦»è‰¯æ¯ã€‚"},
            {"question": "We have some statistics, but we really need something more _____ before we can make any firm decisions.", "answer": "definite", "translation": "æˆ‘ä»¬æŒæ¡äº†ä¸€äº›ç»Ÿè®¡æ•°æ®ï¼Œä½†åœ¨åšå‡ºä»»ä½•æ˜ç¡®å†³ç­–å‰ï¼Œç¡®å®éœ€è¦æ›´ç¡®åˆ‡çš„ä¾æ®ã€‚"},
            {"question": "All doctoral students are expected to hand in their thesis abstracts before Friday, so don't _____ details for the time being.", "answer": "sweat over", "translation": "æ‰€æœ‰åšå£«ç”Ÿéƒ½åº”åœ¨å‘¨äº”å‰æäº¤è®ºæ–‡æ‘˜è¦ï¼Œæ‰€ä»¥ç›®å‰å…ˆåˆ«åœ¨ç»†èŠ‚ä¸Šçº ç»“ã€‚"},
            {"question": "In the past decade, the global mean sea levels have doubled _____ the 20th century trend of 1.6 mm per year.", "answer": "compared to", "translation": "åœ¨è¿‡å»åå¹´é‡Œï¼Œå…¨çƒå¹³å‡æµ·å¹³é¢çš„ä¸Šå‡é€Ÿåº¦æ˜¯ 20 ä¸–çºªæ¯å¹´ 1.6 æ¯«ç±³è¿™ä¸€è¶‹åŠ¿çš„ä¸¤å€ã€‚"},
            {"question": "If you have _____ all the exercises in this book, you are ready for the advanced course.", "answer": "followed through", "translation": "è‹¥æ‚¨å·²å®Œæˆæœ¬ä¹¦æ‰€æœ‰ç»ƒä¹ ï¼Œå³å¯è¿›å…¥è¿›é˜¶è¯¾ç¨‹ã€‚"},
            {"question": "The company's stock has declined by more than 50 percent since the start of this year, _____ last year when it gained 30 percent.", "answer": "in contrast with", "translation": "è¯¥å…¬å¸è‚¡ä»·è‡ªä»Šå¹´å¹´åˆä»¥æ¥å·²ä¸‹è·Œè¶…è¿‡ 50%ï¼Œä¸å»å¹´ä¸Šæ¶¨ 30% å½¢æˆé²œæ˜å¯¹æ¯”ã€‚"},
            {"question": "Studies show that _____ people who consciously control their diet are healthier than those overeating.", "answer": "on average", "translation": "ç ”ç©¶è¡¨æ˜ï¼Œä¸æš´é¥®æš´é£Ÿè€…ç›¸æ¯”ï¼Œè‡ªè§‰æ§åˆ¶é¥®é£Ÿçš„äººç¾¤å¹³å‡å¥åº·çŠ¶å†µæ›´ä½³ã€‚"},
            {"question": "A large quantity of real cases suggest that the average speed of the vehicles _____ closely with the severity of the accident caused.", "answer": "correlates", "translation": "å¤§é‡çœŸå®æ¡ˆä¾‹è¡¨æ˜ï¼Œè½¦è¾†çš„å¹³å‡é€Ÿåº¦ä¸æ‰€é€ æˆçš„äº‹æ•…ä¸¥é‡ç¨‹åº¦ç´§å¯†ç›¸å…³ã€‚"},
            {"question": "Agricultural technologies have _____ farm production, resulting in a dramatic increase in grain output.", "answer": "revolutionized", "translation": "å†œä¸šæŠ€æœ¯å½»åº•æ”¹å˜äº†å†œä¸šç”Ÿäº§ï¼Œå¯¼è‡´äº†ç²®é£Ÿäº§é‡çš„å¤§å¹…åº¦å¢é•¿ã€‚"},
            {"question": "Officials claim that the chemical leak accident _____ no real danger for surrounding residents.", "answer": "poses", "translation": "å®˜å‘˜ä»¬å£°ç§°ï¼Œæ­¤æ¬¡åŒ–å­¦å“æ³„æ¼äº‹æ•…å¯¹å‘¨è¾¹å±…æ°‘ä¸æ„æˆçœŸæ­£çš„å±é™©ã€‚"},
            {"question": "We still have no _____ proof that climate change is caused solely by human activity.", "answer": "conclusive", "translation": "æˆ‘ä»¬ä»ç„¶æ²¡æœ‰ç¡®å‡¿çš„è¯æ®è¯æ˜æ°”å€™å˜åŒ–å®Œå…¨æ˜¯ç”±äººç±»æ´»åŠ¨é€ æˆçš„ã€‚"},
            {"question": "You will have to _____ your comments to our Head Office.", "answer": "address", "translation": "æ‚¨éœ€è¦å°†æ‚¨çš„æ„è§æäº¤ç»™æˆ‘ä»¬æ€»éƒ¨ã€‚"},
            {"question": "He was sentenced to ten years' imprisonment for _____ the stock market and making huge profits illegally.", "answer": "rigging", "translation": "ä»–å› æ“çºµè‚¡å¸‚å’Œéæ³•è·å¾—å·¨é¢åˆ©ç›Šè¢«åˆ¤å¤„ 10 å¹´ç›‘ç¦ã€‚"},
            {"question": "The company, which started out by handling big data, has now _____ into a high-prestige enterprise that covers many domains of internet services.", "answer": "evolved", "translation": "è¿™å®¶ä»¥å¤„ç†å¤§æ•°æ®èµ·å®¶çš„å…¬å¸ï¼Œç°åœ¨å·²å‘å±•æˆä¸ºä¸€å®¶æ¶µç›–å¤šä¸ªäº’è”ç½‘æœåŠ¡é¢†åŸŸçš„é«˜å£°æœ›ä¼ä¸šã€‚"},
            {"question": "If the air pressure in aircraft cabin becomes lower, oxygen masks will _____ drop down.", "answer": "automatically", "translation": "å¦‚æœé£æœºèˆ±å†…æ°”å‹é™ä½ï¼Œæ°§æ°”é¢ç½©ä¼šè‡ªåŠ¨è„±è½ã€‚"},
            {"question": "Farming technology enables the crops to be _____ by liquid fertilizer, which is more effective and sustainable than the conventional method.", "answer": "nourished", "translation": "å†œä¸šæŠ€æœ¯ä½¿å¾—ä½œç‰©å¯ä»¥é€šè¿‡æ¶²ä½“è‚¥æ–™å¾—åˆ°æ»‹å…»ï¼Œè¿™æ¯”ä¼ ç»Ÿæ–¹æ³•æ›´æœ‰æ•ˆï¼Œæ›´å¯æŒç»­ã€‚"},
            {"question": "A study of hundreds of elderly people shows that some have similar lifestyles, but _____ in health conditions.", "answer": "variable", "translation": "ä¸€é¡¹å¯¹æ•°ç™¾åè€å¹´äººçš„ç ”ç©¶è¡¨æ˜ï¼Œæœ‰äº›äººç”Ÿæ´»æ–¹å¼ç›¸ä¼¼ï¼Œä½†å¥åº·çŠ¶å†µä¸ç›¸åŒã€‚"},
            {"question": "The doctor cautions that this drug may have the effect of _____ the Patients' heart rate.", "answer": "speeding up", "translation": "åŒ»ç”Ÿæé†’è¯´ï¼Œè¿™ç§è¯ç‰©å¯èƒ½ä¼šæœ‰åŠ å¿«æ‚£è€…å¿ƒè·³çš„æ•ˆæœã€‚"},
            {"question": "He built up a successful business within short years but it was all done _____ his health.", "answer": "at the expense of", "translation": "ä»–åœ¨çŸ­çŸ­å‡ å¹´å†…å»ºç«‹èµ·äº†ä¸€å®¶æˆåŠŸçš„ä¼ä¸šï¼Œä½†è¿™ä¸€åˆ‡éƒ½æ˜¯ä»¥ä»–å¥åº·ä¸ºä»£ä»·ã€‚"},
            {"question": "It is an army man's duty to _____ orders strictly during a military operation.", "answer": "act on", "translation": "åœ¨å†›äº‹è¡ŒåŠ¨ä¸­ï¼Œä¸¥æ ¼éµå®ˆå‘½ä»¤æ˜¯å†›äººçš„èŒè´£ã€‚"},
            {"question": "_____ public belief, the results of all scientific studies aren't conclusive.", "answer": "Contrary to", "translation": "ä¸å…¬ä¼—çš„æ™®éçœ‹æ³•ç›¸åï¼Œå¹¶éæ‰€æœ‰çš„ç§‘å­¦ç ”ç©¶çš„ç»“æœéƒ½æ˜¯ç»“è®ºæ€§çš„ã€‚"},
            {"question": "If someone tries to persuade you to invest in a project that is least likely to pay off, you might as well _____ it.", "answer": "close your ears to", "translation": "å¦‚æœæœ‰äººè¯•å›¾è¯´æœä½ å»æŠ•èµ„ä¸€ä¸ªæœ€ä¸å¯èƒ½æœ‰å›æŠ¥çš„é¡¹ç›®ï¼Œä½ å¤§å¯å¯¹å…¶ä¸é—»ä¸é—®ã€‚"},
            {"question": "Every year, 1.25 million people die in traffic accidents around the world, which is _____ to the entire population of China's Lijiang City.", "answer": "equivalent", "translation": "å…¨ä¸–ç•Œæ¯å¹´æœ‰ 125 ä¸‡äººæ­»äºäº¤é€šäº‹æ•…ï¼Œç›¸å½“äºä¸­å›½ä¸½æ±Ÿå¸‚çš„æ€»äººå£ã€‚"},
            {"question": "Huawei, a Chinese technology company that provides telecommunication equipment and sells consumer electronics, enjoys high _____ both locally and internationally.", "answer": "prestige", "translation": "åä¸ºæ˜¯ä¸€å®¶æä¾›é€šä¿¡è®¾å¤‡å’Œé”€å”®æ¶ˆè´¹ç”µå­äº§å“çš„ä¸­å›½ç§‘æŠ€å…¬å¸ï¼Œåœ¨å›½å†…å¤–éƒ½äº«æœ‰å¾ˆé«˜çš„å£°æœ›ã€‚"},
            {"question": "His _____ of the theory was not accurate or objective.", "answer": "interpretation", "translation": "ä»–å¯¹è¯¥ç†è®ºçš„è¯ é‡Šæ—¢ä¸å‡†ç¡®ä¹Ÿä¸å®¢è§‚ã€‚"},
            {"question": "We hope that our research will have an _____ on the environment, especially the air quality in cities.", "answer": "impact", "translation": "æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ç ”ç©¶èƒ½å¯¹ç¯å¢ƒäº§ç”Ÿå½±å“ï¼Œå°¤å…¶æ˜¯åŸå¸‚çš„ç©ºæ°”è´¨é‡ã€‚"},
            {"question": "You shouldn't _____ the possibility of losing the match.", "answer": "discount", "translation": "ä½ ä¸åº”ä½ä¼°è¾“æ‰æ¯”èµ›çš„å¯èƒ½æ€§ã€‚"},
            {"question": "It's common _____ in western culture to tip the hairdresser.", "answer": "practice", "translation": "åœ¨è¥¿æ–¹æ–‡åŒ–ä¸­ï¼Œç»™ç†å‘å¸ˆå°è´¹æ˜¯å¸¸è§çš„æƒ¯ä¾‹ã€‚"},
            {"question": "The lawyer's arguments are well grounded because he has collected enough _____ concerning the case.", "answer": "proof", "translation": "å¾‹å¸ˆçš„è®ºç‚¹å¾ˆæœ‰æ ¹æ®ï¼Œå› ä¸ºä»–æ”¶é›†äº†å…³äºæ­¤æ¡ˆçš„è¶³å¤Ÿè¯æ®ã€‚"},
            {"question": "There has been so much media _____ of the facts that nobody knows the truth of the issue.", "answer": "manipulation", "translation": "åª’ä½“å¯¹äº‹å®è¿›è¡Œäº†å¤§é‡æ“æ§ï¼Œä»¥è‡³äºæ²¡äººçŸ¥é“äº‹æƒ…çš„çœŸç›¸ã€‚"},
            {"question": "These workshops, usually of a couple of days' _____, bring scholars and administrators together to address some problems.", "answer": "duration", "translation": "è¿™äº›ç ”è®¨ä¼šé€šå¸¸æŒç»­æ•°å¤©ï¼Œæ±‡é›†å­¦è€…å’Œç®¡ç†è€…å…±åŒè§£å†³ä¸€äº›é—®é¢˜ã€‚"},
            {"question": "The sales of healthcare products have been increasing drastically, which _____ the public's pursuit of health and longevity.", "answer": "mirrors", "translation": "ä¿å¥å“çš„é”€é‡æ€¥å‰§å¢é•¿ï¼Œåæ˜ äº†å…¬ä¼—å¯¹å¥åº·å’Œé•¿å¯¿çš„è¿½æ±‚ã€‚"},
            {"question": "People in rural or underserved urban areas tend to be much _____ when it comes to the latest computing technology.", "answer": "behind the times", "translation": "åœ¨å†œæ‘æˆ–åŸå¸‚æœåŠ¡ä¸è¶³åœ°åŒºï¼Œäººä»¬å¯¹æœ€æ–°çš„è®¡ç®—æŠ€æœ¯å¾€å¾€éå¸¸è½ä¼ã€‚"},
            {"question": "The glaciers on several mountain ranges are decreasing in size _____ reduction in gases that help to maintain temperatures, and changes in the region's climate.", "answer": "due to", "translation": "å‡ æ¡å±±è„‰çš„å†°å·æ­£åœ¨ç¼©å°ï¼Œè¿™æ˜¯ç”±äºæœ‰åŠ©äºç»´æŒæ¸©åº¦çš„æ°”ä½“å‡å°‘ä»¥åŠè¯¥åœ°åŒºæ°”å€™å‘ç”Ÿå˜åŒ–æ‰€è‡´ã€‚"},
            {"question": "Talk to someone or a professional about your problems. Don't let your depression _____.", "answer": "build up", "translation": "å‘ä»–äººæˆ–ä¸“ä¸šäººå£«å€¾è¯‰ä½ çš„é—®é¢˜ï¼Œåˆ«è®©ä½ çš„æŠ‘éƒæƒ…ç»ªç´¯ç§¯ã€‚"},
            {"question": "The increasing number of solitary persons, in a sense, is _____ the lack of communication in the modern world.", "answer": "a metaphor for", "translation": "ä»æŸç§æ„ä¹‰ä¸Šè¯´ï¼Œç‹¬å±…è€…äººæ•°çš„å¢åŠ æ˜¯ç°ä»£ä¸–ç•Œç¼ºä¹æ²Ÿé€šçš„å†™ç…§ã€‚"},
            {"question": "He is studying like crazy to _____ the lessons he missed during his stay in the hospital.", "answer": "make up", "translation": "ä»–æ­£åœ¨ç–¯ç‹‚å­¦ä¹ ï¼Œä»¥å¼¥è¡¥ä½é™¢æœŸé—´è½ä¸‹çš„è¯¾ç¨‹ã€‚"},
            {"question": "The company's new president will have to _____ some complicated legal problems from his predecessor.", "answer": "inherit", "translation": "å…¬å¸çš„æ–°æ€»è£å°†ä¸å¾—ä¸æ¥æ‰‹å‰ä»»ç•™ä¸‹çš„ä¸€äº›å¤æ‚çš„æ³•å¾‹é—®é¢˜ã€‚"},
            {"question": "The railway company claimed that they would _____ 20 percent of a fare if their train is more than an hour late.", "answer": "refund", "translation": "é“è·¯å…¬å¸å£°ç§°ï¼Œå¦‚æœåˆ—è½¦æ™šç‚¹è¶…è¿‡ä¸€å°æ—¶ï¼Œä»–ä»¬å°†é€€è¿˜ 20% çš„è½¦è´¹ã€‚"},
            {"question": "There are rules to prohibit emission of poisonous waste, yet some factories _____ them for the sake of costs.", "answer": "disregard", "translation": "è™½ç„¶æœ‰è§„å®šç¦æ­¢æ’æ”¾æœ‰æ¯’åºŸç‰©ï¼Œä½†ä¸€äº›å·¥å‚ä¸ºäº†æˆæœ¬è€ƒè™‘å¯¹æ­¤ç½®ä¹‹ä¸ç†ã€‚"},
            {"question": "The system is so sensitive that it can _____ changes in temperature as small as 0.003 degrees.", "answer": "detect", "translation": "è¯¥ç³»ç»Ÿéå¸¸çµæ•ï¼Œèƒ½å¤Ÿæ£€æµ‹åˆ°å°è‡³ 0.003 åº¦çš„æ¸©åº¦å˜åŒ–ã€‚"},
            {"question": "The composer _____ that he copied the tune from an old Beatles song.", "answer": "denies", "translation": "è¿™ä½ä½œæ›²å®¶å¦è®¤ä»–ä»ä¸€é¦–æŠ«å¤´å£«çš„è€æ­Œä¸­æŠ„è¢­äº†æ›²è°ƒã€‚"},
            {"question": "After 30 years' living in Guangzhou, Elizabeth has been _____ into the local culture, and now she speaks fluent Cantonese.", "answer": "assimilated", "translation": "åœ¨å¹¿å·ç”Ÿæ´»äº† 30 å¹´åï¼Œä¼Šä¸½èç™½å·²èå…¥äº†å½“åœ°æ–‡åŒ–ï¼Œç°åœ¨èƒ½è¯´ä¸€å£æµåˆ©çš„ç²¤è¯­ã€‚"},
            {"question": "The executives believed that combining the two work teams would _____ their strength by several times.", "answer": "multiply", "translation": "é«˜ç®¡ä»¬ç›¸ä¿¡ï¼Œå°†è¿™ä¸¤ä¸ªå·¥ä½œå›¢é˜Ÿåˆå¹¶ä¼šä½¿ä»–ä»¬çš„åŠ›é‡æˆå€å¢åŠ ã€‚"},
            {"question": "Some manual labor is bound to be _____ by artificial intelligence, so workers need retraining for more technical jobs.", "answer": "displaced", "translation": "ä¸€äº›ä½“åŠ›åŠ³åŠ¨å¿…ç„¶ä¼šè¢«äººå·¥æ™ºèƒ½å–ä»£ï¼Œå› æ­¤å·¥äººéœ€è¦æ¥å—å†åŸ¹è®­ä»¥ä»äº‹æŠ€æœ¯æ€§æ›´å¼ºçš„å·¥ä½œã€‚"},
            {"question": "The common nutrition advice usually includes the general statement 'eat less _____ food and choose fresh food instead.", "answer": "processed", "translation": "å¸¸è§çš„è¥å…»å»ºè®®é€šå¸¸åŒ…æ‹¬è¿™æ ·ä¸€å¥é€šç”¨çš„è¯ï¼šâ€œå°‘åƒåŠ å·¥é£Ÿå“ï¼Œé€‰æ‹©æ–°é²œé£Ÿå“ã€‚â€"},
            {"question": "Some people are anxious to try various health _____, but never stick to any of them.", "answer": "regimes", "translation": "æœ‰äº›äººæ€¥äºå°è¯•å„ç§å…»ç”Ÿæ–¹æ³•ï¼Œä½†ä»æœªåšæŒè¿‡ä»»ä½•ä¸€ç§ã€‚"},
            {"question": "It will take some time for the applicants to _____ the forms for overseas study programs.", "answer": "fill out", "translation": "ç”³è¯·è€…éœ€è¦ä¸€äº›æ—¶é—´æ¥å¡«å†™æµ·å¤–ç•™å­¦é¡¹ç›®çš„ç”³è¯·è¡¨ã€‚"},
            {"question": "The case was handed over to independent investigators so that there could be no inference of bias _____ any party.", "answer": "in favor of", "translation": "è¯¥æ¡ˆè¢«ç§»äº¤ç»™ç‹¬ç«‹è°ƒæŸ¥å‘˜ï¼Œä»¥ç¡®ä¿ä¸ä¼šäº§ç”Ÿåè¢’ä»»ä½•ä¸€æ–¹çš„å«Œç–‘ã€‚"},
            {"question": "The government programs are intended to _____ poverty throughout the country within ten years.", "answer": "be rid of", "translation": "è¿™äº›æ”¿åºœè®¡åˆ’æ—¨åœ¨åå¹´å†…åœ¨å…¨å›½èŒƒå›´å†…æ¶ˆé™¤è´«å›°ã€‚"},
            {"question": "When you have to cope with so many issues at the same time, mistakes _____ happen.", "answer": "are bound to", "translation": "å½“ä½ ä¸å¾—ä¸åŒæ—¶å¤„ç†è¿™ä¹ˆå¤šé—®é¢˜æ—¶ï¼Œé”™è¯¯å¿…ç„¶ä¼šå‘ç”Ÿã€‚"},
            {"question": "As a result, the method of _____ means convenience for the policy makers, but not practical to the local governments with their specific needs and situations.", "answer": "one size fits all", "translation": "å› æ­¤ï¼Œâ€œä¸€åˆ€åˆ‡â€çš„æ–¹æ³•å¯¹æ”¿ç­–åˆ¶å®šè€…æ¥è¯´æ„å‘³ç€ä¾¿åˆ©ï¼Œä½†å¯¹äºæœ‰ç‰¹å®šéœ€æ±‚å’Œæƒ…å†µçš„å½“åœ°æ”¿åºœæ¥è¯´å¹¶ä¸åˆ‡å®é™…ã€‚"},
            {"question": "What is fundamental to a company's survival is to _____ and always go a few steps ahead in the industry.", "answer": "innovate", "translation": "ä¸€å®¶å…¬å¸ç”Ÿå­˜çš„æ ¹æœ¬åœ¨äºåˆ›æ–°ï¼Œå¹¶å§‹ç»ˆä¿æŒè¡Œä¸šé¢†å…ˆå‡ æ­¥ã€‚"},
            {"question": "All the member countries at the conference have signed a treaty to _____ their loyalty to the alliance.", "answer": "proclaim", "translation": "ä¸ä¼šå„å›½ç­¾ç½²äº†ä¸€é¡¹æ¡çº¦ï¼Œä»¥è¡¨æ˜ä»–ä»¬å¯¹è”ç›Ÿçš„å¿ è¯šã€‚"},
            {"question": "It is well _____ that women generally have a longer life span than men.", "answer": "documented", "translation": "å¥³æ€§é€šå¸¸æ¯”ç”·æ€§å¯¿å‘½æ›´é•¿ï¼Œè¿™ä¸€ç‚¹å·²æœ‰å……åˆ†è®°è½½ã€‚"},
            {"question": "The attorney's arguments are valid since he has collected enough _____ concerning the case.", "answer": "proof", "translation": "å¾‹å¸ˆçš„è®ºç‚¹æ˜¯æœ‰åŠ›çš„ï¼Œå› ä¸ºä»–å·²æ”¶é›†äº†å…³äºæ­¤æ¡ˆçš„å……åˆ†è¯æ®ã€‚"},
            {"question": "Their _____ views have been opposed by the public.", "answer": "extreme", "translation": "ä»–ä»¬çš„æç«¯è§‚ç‚¹é­åˆ°äº†å…¬ä¼—çš„åå¯¹ã€‚"},
            {"question": "Studies suggest that regular intake of vitamins significantly improves brain _____.", "answer": "function", "translation": "ç ”ç©¶è¡¨æ˜ï¼Œå®šæœŸæ‘„å…¥ç»´ç”Ÿç´ èƒ½æ˜¾è‘—æ”¹å–„å¤§è„‘åŠŸèƒ½ã€‚"},
            {"question": "It is proved that playing sports can _____ the social development of young people, teaching them how to interact with peers outside the classroom.", "answer": "foster", "translation": "äº‹å®è¯æ˜ï¼Œè¿›è¡Œä½“è‚²è¿åŠ¨èƒ½ä¿ƒè¿›é’å°‘å¹´çš„ç¤¾ä¼šå‘å±•ï¼Œæ•™ä¼šä»–ä»¬å¦‚ä½•åœ¨è¯¾å ‚å¤–ä¸åŒé¾„äººäº’åŠ¨ã€‚"},
            {"question": "Big-name employers, from central enterprises to tech giants, have a(n) _____ in favor of recruiting graduates from prestigious universities.", "answer": "bias", "translation": "ä»å¤®ä¼åˆ°ç§‘æŠ€å·¨å¤´ï¼ŒçŸ¥åé›‡ä¸»æ™®éå­˜åœ¨ä¸€ç§åçˆ±æ‹›è˜åæ ¡æ¯•ä¸šç”Ÿçš„åè§ã€‚"},
            {"question": "His account of the situation was very _____ and you should check facts before making a judgment.", "answer": "biased", "translation": "ä»–å¯¹æƒ…å†µçš„æè¿°å¸¦æœ‰å¾ˆå¤§åè§ï¼Œä½ åœ¨åšåˆ¤æ–­å‰åº”è¯¥æ ¸å®äº‹å®ã€‚"},
            {"question": "Despite low interest rates, the concept of depositing money in the bank still _____ among the vast majority of people.", "answer": "prevails", "translation": "å°½ç®¡åˆ©ç‡å¾ˆä½ï¼Œåœ¨é“¶è¡Œå­˜æ¬¾çš„è§‚å¿µä»åœ¨ç»å¤§å¤šæ•°äººä¸­æµè¡Œã€‚"},
            {"question": "He couldn't find the application form; probably he had not even been given one _____.", "answer": "in the first place", "translation": "ä»–æ‰¾ä¸åˆ°ç”³è¯·è¡¨ï¼›å¯èƒ½ä¸€å¼€å§‹å°±æ²¡æœ‰äººç»™ä»–ä¸€ä»½ã€‚"},
            {"question": "They often look towards the same evidence as those _____ proving its existence, but draw different conclusions.", "answer": "in favor of", "translation": "ä»–ä»¬å¸¸å¸¸å’Œé‚£äº›æ”¯æŒå…¶å­˜åœ¨çš„äººçœ‹åŒæ ·çš„è¯æ®ï¼Œå´å¾—å‡ºä¸åŒçš„ç»“è®ºã€‚"},
            {"question": "An alarming number of physicians are unable to _____ the pressure of practicing everyday medicine.", "answer": "cope with", "translation": "æ•°é‡æƒŠäººçš„åŒ»ç”Ÿæ— æ³•åº”å¯¹æ—¥å¸¸è¡ŒåŒ»çš„å‹åŠ›ã€‚"},
            {"question": "In preparation for the spelling competition, students are busy reviewing the words in the dictionary and trying to _____ them to memory.", "answer": "commit", "translation": "ä¸ºå‡†å¤‡æ‹¼å†™æ¯”èµ›ï¼Œå­¦ç”Ÿä»¬æ­£å¿™äºå¤ä¹ è¯å…¸é‡Œçš„å•è¯ï¼Œå¹¶åŠªåŠ›æŠŠå®ƒä»¬è®°ä¸‹æ¥ã€‚"},
            {"question": "When you are in a leadership position, many people will _____ whether intentionally or not.", "answer": "take a leaf from your book", "translation": "å½“ä½ èº«å¤„é¢†å¯¼èŒä½æ—¶ï¼Œå¾ˆå¤šäººéƒ½ä¼šæœ‰æ„è¯†æˆ–æ— æ„è¯†åœ°æ•ˆä»¿ä½ ã€‚"}
        ];

        // --- å…¨å±€çŠ¶æ€ç®¡ç† ---
        const AppState = {
            status: [], // 0:æœªåš, 1:æ­£ç¡®, 2:é”™è¯¯
            mistakeCount: 0,
            
            // å½“å‰ä¼šè¯çŠ¶æ€
            currentMode: 'random', // random, sequential, review
            practiceQueue: [], // å¾…åˆ·é¢˜ç›®ç´¢å¼•æ•°ç»„
            currentQueueIndex: 0,
            isAnswered: false,
            currentOptions: [], // å­˜å‚¨å½“å‰é¢˜ç›®é€‰é¡¹ï¼Œç”¨äºé”®ç›˜æ˜ å°„
            autoAdvance: true // è‡ªåŠ¨åˆ‡é¢˜
        };

        // --- åˆå§‹åŒ–ä¸æœ¬åœ°å­˜å‚¨ ---
        function initApp() {
            // åŠ è½½ä¸»é¢˜
            if(localStorage.getItem('theme') === 'dark') {
                document.body.setAttribute('data-theme', 'dark');
            }

            // åŠ è½½è¿›åº¦
            const savedStatus = localStorage.getItem('eng_quiz_status');
            if (savedStatus) {
                AppState.status = JSON.parse(savedStatus);
                // æ ¡éªŒé•¿åº¦é˜²æ­¢é¢˜åº“æ›´æ–°åæŠ¥é”™
                if(AppState.status.length !== rawQuestionBank.length) {
                    AppState.status = new Array(rawQuestionBank.length).fill(0);
                }
            } else {
                AppState.status = new Array(rawQuestionBank.length).fill(0);
            }

            // åŠ è½½è‡ªåŠ¨åˆ‡é¢˜è®¾ç½®
            const savedAutoAdvance = localStorage.getItem('eng_auto_advance');
            if (savedAutoAdvance !== null) {
                AppState.autoAdvance = (savedAutoAdvance === 'true');
            }
            document.getElementById('auto-advance-toggle').checked = AppState.autoAdvance;
            
            updateStatsView();
            setupKeyboardListener();
        }

        function saveProgress() {
            localStorage.setItem('eng_quiz_status', JSON.stringify(AppState.status));
            updateStatsView();
        }

        function toggleAutoAdvance() {
            AppState.autoAdvance = document.getElementById('auto-advance-toggle').checked;
            localStorage.setItem('eng_auto_advance', AppState.autoAdvance);
        }

        // --- æ ¸å¿ƒé€»è¾‘ ---

        function startPractice(mode) {
            AppState.currentMode = mode;
            AppState.practiceQueue = generateQueue(mode);
            
            if (AppState.practiceQueue.length === 0) {
                if(mode === 'review') {
                    alert("ğŸ‰ å¤ªæ£’äº†ï¼ä½ ç›®å‰æ²¡æœ‰é”™é¢˜è®°å½•ï¼");
                } else {
                    alert("æ‰€æœ‰é¢˜ç›®å·²å®Œæˆï¼å»ºè®®é‡ç½®è¿›åº¦æˆ–å¤ä¹ é”™é¢˜ã€‚");
                }
                return;
            }

            AppState.currentQueueIndex = 0;
            switchView('quiz');
            loadQuestion();
        }

        function generateQueue(mode) {
            let indices = [];
            if (mode === 'review') {
                // ç­›é€‰å‡ºé”™é¢˜ (status == 2)
                rawQuestionBank.forEach((_, idx) => {
                    if (AppState.status[idx] === 2) indices.push(idx);
                });
                shuffleArray(indices); // é”™é¢˜ä¹Ÿè¦ä¹±åº
            } else if (mode === 'sequential') {
                // é¡ºåºæ¨¡å¼ï¼šæ‰¾å‡ºæ‰€æœ‰æœªåš(0) æˆ– é”™è¯¯(2) çš„é¢˜ç›®ï¼ŒæŒ‰é¡ºåº
                rawQuestionBank.forEach((_, idx) => {
                    if (AppState.status[idx] !== 1) indices.push(idx); // å·²æŒæ¡çš„(1)å°±ä¸æ¨äº†ï¼Œé™¤éé‡ç½®
                });
            } else {
                // éšæœºæ¨¡å¼
                rawQuestionBank.forEach((_, idx) => indices.push(idx));
                shuffleArray(indices);
            }
            return indices;
        }

        function loadQuestion() {
            // æ£€æŸ¥æ˜¯å¦ç»“æŸ
            if (AppState.currentQueueIndex >= AppState.practiceQueue.length) {
                alert("ğŸ‰ æœ¬è½®ç»ƒä¹ å®Œæˆï¼");
                exitPractice();
                return;
            }

            const realIndex = AppState.practiceQueue[AppState.currentQueueIndex];
            const questionData = rawQuestionBank[realIndex];
            AppState.isAnswered = false;

            // UI æ›´æ–°
            document.getElementById('current-index-display').innerText = realIndex + 1;
            document.getElementById('remaining-count').innerText = AppState.practiceQueue.length - AppState.currentQueueIndex - 1;
            document.getElementById('mode-badge').innerText = getModeName(AppState.currentMode);
            document.getElementById('session-progress').style.width = `${(AppState.currentQueueIndex / AppState.practiceQueue.length) * 100}%`;
            
            // æ¸²æŸ“é¢˜ç›®æ–‡æœ¬ (æŒ–ç©ºå¤„ç†)
            const blankHtml = `<span class="highlight-blank">____</span>`;
            const displayQ = questionData.question.replace('_____', blankHtml);
            document.getElementById('question-text').innerHTML = displayQ;

            // æ¸²æŸ“é€‰é¡¹
            const options = generateOptions(questionData.answer);
            AppState.currentOptions = options; // å­˜ä¸‹æ¥ç”¨äºé”®ç›˜é€»è¾‘
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';

            options.forEach((opt, idx) => {
                const btn = document.createElement('div');
                btn.className = 'option-card';
                btn.innerHTML = `<span class="option-key">${idx + 1}</span> <span>${opt}</span>`;
                btn.onclick = () => handleAnswer(opt, idx);
                btn.dataset.val = opt;
                btn.id = `opt-${idx}`;
                optionsContainer.appendChild(btn);
            });

            // éšè—è§£æ
            document.getElementById('analysis-box').style.display = 'none';
            document.getElementById('next-btn').style.display = 'none'; // ç­”å®Œæ‰æ˜¾ç¤º
            document.getElementById('show-answer-btn').disabled = false;
        }

        function generateOptions(correctAnswer) {
            // è·å–æ‰€æœ‰é”™è¯¯ç­”æ¡ˆ
            const allAnswers = rawQuestionBank.map(q => q.answer);
            const wrongPool = allAnswers.filter(a => a !== correctAnswer);
            
            // éšæœºé€‰3ä¸ªé”™è¯¯ç­”æ¡ˆ
            shuffleArray(wrongPool);
            const selectedWrong = wrongPool.slice(0, 3);
            
            const options = [correctAnswer, ...selectedWrong];
            shuffleArray(options);
            return options;
        }

        function handleAnswer(selectedVal, domIndex) {
            if (AppState.isAnswered) return;
            AppState.isAnswered = true;

            const realIndex = AppState.practiceQueue[AppState.currentQueueIndex];
            const correctVal = rawQuestionBank[realIndex].answer;
            const isCorrect = selectedVal === correctVal;

            // æ›´æ–°æ•°æ®
            AppState.status[realIndex] = isCorrect ? 1 : 2;
            saveProgress();

            // UI åé¦ˆ
            const options = document.querySelectorAll('.option-card');
            options.forEach(opt => {
                if(opt.dataset.val === correctVal) opt.classList.add('correct');
                else if(opt.dataset.val === selectedVal && !isCorrect) opt.classList.add('incorrect');
            });

            // æ˜¾ç¤ºè§£æ
            const analysisBox = document.getElementById('analysis-box');
            document.getElementById('feedback-title').innerHTML = isCorrect ? 
                '<span style="color:var(--success-color)">âœ“ å›ç­”æ­£ç¡®</span>' : 
                '<span style="color:var(--error-color)">âœ— å›ç­”é”™è¯¯</span>';
            document.getElementById('translation-text').innerText = rawQuestionBank[realIndex].translation;
            analysisBox.style.display = 'block';
            document.getElementById('next-btn').style.display = 'inline-block';
            document.getElementById('show-answer-btn').disabled = true;

            // è‡ªåŠ¨åˆ‡é¢˜é€»è¾‘
            if(isCorrect && AppState.autoAdvance) {
                // å»¶æ—¶ 0.7ç§’ è·³è½¬ï¼Œè®©ç”¨æˆ·çœ‹æ¸…â€œç»¿è‰²â€æ­£ç¡®åé¦ˆ
                setTimeout(() => {
                    // ç¡®ä¿ç”¨æˆ·æ²¡æœ‰åœ¨ç­‰å¾…æœŸé—´æ‰‹åŠ¨ç‚¹äº†é€€å‡º
                    if (document.getElementById('quiz-view').style.display !== 'none') {
                        nextQuestion();
                    }
                }, 700); 
            }
        }

        function nextQuestion() {
            if (!AppState.isAnswered) return;
            AppState.currentQueueIndex++;
            loadQuestion();
        }

        function showAnswer() {
            if (AppState.isAnswered) return;
            // è§†ä¸ºç­”é”™
            const realIndex = AppState.practiceQueue[AppState.currentQueueIndex];
            AppState.status[realIndex] = 2; // æ ‡è®°ä¸ºé”™é¢˜
            saveProgress();
            
            // è§¦å‘UIæ˜¾ç¤º
            handleAnswer("SHOW_ANSWER_TRIGGER", -1);
        }

        // --- è¾…åŠ©åŠŸèƒ½ ---

        function updateStatsView() {
            const total = rawQuestionBank.length;
            const done = AppState.status.filter(s => s !== 0).length;
            const correct = AppState.status.filter(s => s === 1).length;
            const wrong = AppState.status.filter(s => s === 2).length;

            document.getElementById('stat-total').innerText = total;
            document.getElementById('stat-done').innerText = done;
            document.getElementById('stat-wrong').innerText = wrong;
            document.getElementById('stat-accuracy').innerText = done > 0 ? Math.round((correct / done) * 100) + '%' : '0%';

            // æ§åˆ¶é”™é¢˜æŒ‰é’®çŠ¶æ€
            document.getElementById('btn-review-mistakes').disabled = (wrong === 0);
        }

        function switchView(viewName) {
            document.getElementById('stats-view').style.display = viewName === 'stats' ? 'block' : 'none';
            document.getElementById('quiz-view').style.display = viewName === 'quiz' ? 'block' : 'none';
            if(viewName === 'stats') updateStatsView();
        }

        function exitPractice() {
            switchView('stats');
        }

        function resetAllProgress() {
            if(confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰åˆ·é¢˜è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚')) {
                AppState.status = new Array(rawQuestionBank.length).fill(0);
                saveProgress();
            }
        }

        function toggleTheme() {
            const body = document.body;
            if (body.getAttribute('data-theme') === 'dark') {
                body.removeAttribute('data-theme');
                localStorage.setItem('theme', 'light');
            } else {
                body.setAttribute('data-theme', 'dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        function getModeName(mode) {
            const map = { 'random': 'éšæœº', 'sequential': 'é¡ºåº', 'review': 'é”™é¢˜' };
            return map[mode] || 'ç»ƒä¹ ';
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // --- é”®ç›˜æ”¯æŒ ---
        function setupKeyboardListener() {
            document.addEventListener('keydown', (e) => {
                if (document.getElementById('quiz-view').style.display === 'none') return;

                const key = e.key;
                // é€‰é¡¹ 1-4
                if (['1', '2', '3', '4'].includes(key)) {
                    const idx = parseInt(key) - 1;
                    const optBtn = document.getElementById(`opt-${idx}`);
                    if (optBtn && !AppState.isAnswered) {
                        optBtn.click();
                    }
                }
                // Enter ä¸‹ä¸€é¢˜
                if (key === 'Enter') {
                    if (AppState.isAnswered) {
                        nextQuestion();
                    }
                }
            });
        }

        // --- æ•°æ®å¯¼å…¥å¯¼å‡º ---
        function openDataModal() {
            document.getElementById('data-modal').style.display = 'flex';
            // å¯¼å‡ºå½“å‰æ•°æ®
            const data = {
                status: AppState.status,
                timestamp: new Date().toISOString()
            };
            document.getElementById('data-area').value = JSON.stringify(data);
        }

        function closeDataModal() {
            document.getElementById('data-modal').style.display = 'none';
        }

        function importData() {
            try {
                const jsonStr = document.getElementById('data-area').value;
                const data = JSON.parse(jsonStr);
                if (Array.isArray(data.status) && data.status.length === rawQuestionBank.length) {
                    AppState.status = data.status;
                    saveProgress();
                    alert("æ•°æ®æ¢å¤æˆåŠŸï¼");
                    closeDataModal();
                    updateStatsView();
                } else {
                    alert("æ•°æ®æ ¼å¼ä¸æ­£ç¡®ï¼Œæ— æ³•æ¢å¤ã€‚");
                }
            } catch (e) {
                alert("JSON è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ•°æ®æ ¼å¼ã€‚");
            }
        }

        // å¯åŠ¨
        initApp();
    </script>
</body>
</html>